# 命令行钱包 - 基于 Viem.js

一个基于 Viem.js 的命令行以太坊钱包，支持在 Sepolia 测试网上进行 ERC20 代币转账。

## 功能特性

✅ **生成私钥** - 生成新的以太坊私钥和地址
✅ **查询余额** - 查询 ETH 和 ERC20 代币余额
✅ **EIP-1559 交易** - 使用 EIP-1559 标准构建交易
✅ **签名交易** - 使用私钥对交易进行签名
✅ **发送交易** - 将签名后的交易发送到 Sepolia 测试网
✅ **钱包持久化** - 自动保存和加载钱包信息

## 项目结构

```
wallet/
├── index.js              # 主程序入口，命令行界面
├── walletFunctions.js    # 核心钱包功能模块
├── erc20Abi.js          # ERC20 标准 ABI 定义
├── package.json         # 项目依赖配置
└── .wallet.json         # 钱包数据存储（自动生成）
```

## 安装依赖

```bash
cd wallet
npm install
```

主要依赖：
- `viem` - 以太坊交互库
- `dotenv` - 环境变量管理

## 使用方法

### 启动钱包

```bash
node index.js
```

### 主菜单选项

```
1. 生成新钱包     - 生成新的私钥和地址
2. 导入钱包       - 通过私钥导入已有钱包
3. 查看钱包信息   - 显示当前钱包的详细信息
4. 查询余额       - 查询 ETH 或 ERC20 代币余额
5. 发送 ERC20 代币 - 构建并发送 EIP-1559 交易
6. 退出
```

## 使用示例

### 1. 生成新钱包

选择选项 `1`，程序将生成新的私钥和地址：

```
✓ 新钱包已生成！
================================================================================
私钥: 0x1234...abcd
地址: 0x5678...ef01
================================================================================
⚠️  警告: 请妥善保管私钥，不要泄露给他人！
```

### 2. 查询 ETH 余额

选择选项 `4`，然后选择 `1` 查询 ETH：

```
正在查询 ETH 余额...
✓ ETH 余额: 0.5 ETH
地址: 0x5678...ef01
```

### 3. 查询 ERC20 代币余额

选择选项 `4`，然后选择 `2` 查询 ERC20：

```
请输入 ERC20 代币合约地址: 0x779877A7B0D9E8603169DdbD7836e478b4624789
正在查询代币余额...
✓ LINK 余额: 100.5 LINK
代币合约: 0x779877A7B0D9E8603169DdbD7836e478b4624789
小数位数: 18
```

### 4. 发送 ERC20 代币

选择选项 `5`，按提示输入信息：

```
请输入 ERC20 代币合约地址: 0x779877A7B0D9E8603169DdbD7836e478b4624789
请输入接收地址: 0x1234...5678
请输入转账金额: 10
请输入代币小数位数 (默认 18): 18

准备发送交易...
从: 0x5678...ef01
到: 0x1234...5678
金额: 10
代币合约: 0x779877A7B0D9E8603169DdbD7836e478b4624789

交易 Gas 参数 (EIP-1559):
- Base Fee: 0.000000012 ETH
- Max Priority Fee (小费): 0.000000002 ETH
- Max Fee: 0.000000026 ETH

✓ 交易模拟成功，准备发送...
✓ 交易已发送！
交易哈希: 0xabcd...1234
查看交易: https://sepolia.etherscan.io/tx/0xabcd...1234

等待交易确认...
✓ 交易已确认！
区块号: 5234567
Gas 使用量: 65000
交易状态: 成功
```

## 技术实现细节

### EIP-1559 交易类型

本钱包使用 EIP-1559 交易标准，包含以下特性：

- **Base Fee**: 由网络动态决定的基础费用
- **Max Priority Fee**: 给矿工的小费（设置为 2 gwei）
- **Max Fee**: 最大愿意支付的费用（baseFee * 2 + 小费）

### 交易流程

1. **生成/导入账户** - 使用私钥创建账户对象
2. **构建交易** - 使用 ERC20 ABI 构建 transfer 函数调用
3. **模拟执行** - 通过 `simulateContract` 验证交易可行性
4. **签名交易** - 使用私钥对交易进行签名（自动完成）
5. **发送交易** - 将签名后的交易广播到网络
6. **等待确认** - 监听交易确认状态

### 核心函数说明

#### `generateNewPrivateKey()`
生成新的随机私钥

#### `createAccountFromPrivateKey(privateKey)`
从私钥创建账户对象，包含地址和签名功能

#### `getEthBalance(address)`
查询指定地址的 ETH 余额

#### `getErc20Balance(address, tokenAddress)`
查询指定地址的 ERC20 代币余额、符号和小数位数

#### `sendErc20Transaction(privateKey, tokenAddress, toAddress, amount, decimals)`
完整的 ERC20 转账流程：
1. 创建账户和客户端
2. 获取 Gas 参数
3. 构建和模拟交易
4. 签名并发送交易
5. 等待交易确认

## 测试网配置

- **网络**: Sepolia 测试网
- **RPC 端点**: https://rpc.sepolia.org
- **区块浏览器**: 


### 获取测试 ETH

你可以从以下水龙头获取测试 ETH：
- https://sepoliafaucet.com/
- https://www.alchemy.com/faucets/ethereum-sepolia

### 测试用 ERC20 代币

Sepolia 上的一些测试代币：
- **LINK**: 0x779877A7B0D9E8603169DdbD7836e478b4624789
- **USDC**: 0x94a9D9AC8a22534E3FaCa9F4e7F2E2cf85d5E4C8

## 安全注意事项

⚠️ **重要提醒**：

1. **私钥安全** - 私钥会保存在 `.wallet.json` 文件中，请妥善保管
2. **仅限测试** - 本钱包仅用于 Sepolia 测试网，不要在主网使用
3. **不要分享私钥** - 永远不要将私钥分享给他人
4. **备份私钥** - 请备份你的私钥，丢失后无法恢复

## 常见问题

### Q: 交易失败怎么办？

A: 检查以下几点：
- 账户是否有足够的 ETH 支付 Gas 费用
- ERC20 代币余额是否足够
- 代币合约地址是否正确
- 网络连接是否正常

### Q: 如何查看交易详情？

A: 复制交易哈希，在浏览器中访问：
```
https://sepolia.etherscan.io/tx/YOUR_TX_HASH
```

### Q: 钱包数据存储在哪里？

A: 钱包数据保存在 `.wallet.json` 文件中，包含私钥和地址信息。

## 代码文件说明

### [index.js](index.js)
主程序文件，实现命令行交互界面和用户输入处理。

### [walletFunctions.js](walletFunctions.js)
核心功能模块，包含所有钱包相关的业务逻辑：
- 私钥生成和管理
- 余额查询
- 交易构建、签名和发送

### [erc20Abi.js](erc20Abi.js)
ERC20 标准接口的 ABI 定义，包含：
- `balanceOf` - 查询余额
- `transfer` - 转账
- `decimals` - 获取小数位数
- `symbol` - 获取代币符号

## 扩展功能建议

可以继续添加的功能：
- [ ] 支持 ETH 转账
- [ ] 多账户管理
- [ ] 交易历史记录
- [ ] Gas 费用优化选项
- [ ] 支持其他测试网（Goerli, Mumbai 等）
- [ ] ERC721 NFT 支持
- [ ] 助记词支持

## 许可证

MIT
